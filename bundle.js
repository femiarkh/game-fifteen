(()=>{"use strict";const e={shuffle:e=>{const t=e.slice();for(let e=t.length-1;e>0;e+=-1){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t},createElement(e,t){const s=document.createElement(e);return t&&s.classList.add(t),s},padWithZeroes:e=>e<10?`0${e}`:e.toString(),formatTime(e){if(e<60)return this.padWithZeroes(e);if(e<3600)return`${this.padWithZeroes(Math.floor(e/60))}:${this.padWithZeroes(e%60)}`;const t=e%3600;return`${this.padWithZeroes(Math.floor(e/3600))}:${this.padWithZeroes(Math.floor(t/60))}:${this.padWithZeroes(t%60)}`}},t=[{author:"Иван Айвазовский",name:"Девятый вал",year:"1850"},{author:"Илья Репин",name:"Бурлаки на Волге",year:"1873"},{author:"Илья Репин",name:"Не ждали",year:"1888"},{author:"Илья Репин",name:"Вечорници",year:"1881"},{author:"Илья Репин",name:"Проводы новобранца",year:"1879"},{author:"Илья Репин",name:"Крестный ход",year:"1883"},{author:"Илья Репин",name:"Иван Грозный и сын его Иван",year:"1885"},{author:"Илья Репин",name:"Садко",year:"1876"},{author:"Илья Репин",name:"Приготовление к экзамену",year:"1864"},{author:"Илья Репин",name:"Летний пейзаж",year:"1879"},{author:"Илья Репин",name:"Запорожцы",year:"1891"},{author:"Иван Крамской",name:"Неизвестная",year:"1883"},{author:"Сандро Боттичелли",name:"Рождение Венеры",year:"1486"},{author:"Иван Шишкин",name:"Утро в сосновом лесу",year:"1889"},{author:"Рембрандт",name:"Ночной дозор",year:"1642"},{author:"Леонардо да Винчи",name:"Тайная вечеря",year:"1498"},{author:"Сальвадор Дали",name:"Постоянство памяти",year:"1931"},{author:"Поль Гоген",name:"Откуда мы пришли? Кто мы? Куда мы идём?",year:"1898"},{author:"Эжен Делакруа",name:"Свобода, ведущая народ",year:"1830"},{author:"Михаил Врубель",name:"Демон сидящий",year:"1890"},{author:"Эдуар Мане",name:"Бар в «Фоли-Бержер»",year:"1882"},{author:"Тициан",name:"Любовь земная и Любовь небесная",year:"1516"},{author:"Михаил Нестеров",name:"Видение отроку Варфоломею",year:"1890"},{author:"Питер Брейгель",name:"Притча о слепых",year:"1568"},{author:"Виктор Васнецов",name:"Аленушка",year:"1881"},{author:"Карл Брюллов",name:"Последний день Помпеи",year:"1833"},{author:"Пабло Пикассо",name:"Девочка на шаре",year:"1905"},{author:"Эдгар Дега",name:"Голубые танцовщицы",year:"1897"},{author:"Леонардо да Винчи",name:"Мона Лиза",year:"1505"},{author:"Микеланджело",name:"Сотворение Адама",year:"1511"},{author:"Ян Вермеер",name:"Девушка с жемчужной серёжкой",year:"1665"},{author:"Василий Суриков",name:"Боярыня Морозова",year:"1887"},{author:"Виктор Васнецов",name:"Богатыри",year:"1898"},{author:"Андрей Рублев",name:"Троица",year:"1411"},{author:"Пабло Пикассо",name:"Герника",year:"1937"},{author:"Иероним Босх",name:"Сад земных наслаждений",year:"1510"},{author:"Эдвард Мунк",name:"Крик",year:"1893"},{author:"Марк Шагал",name:"Прогулка",year:"1918"},{author:"Иванов Александр",name:"Явление Христа народу",year:"1857"},{author:"Федотов Павел",name:"Сватовство майора",year:"1852"},{author:"Василий Верещагин",name:"Апофеоз войны",year:"1817"},{author:"Джорджоне",name:"Спящая Венера",year:"1510"},{author:"Питер Брейгель",name:"Охотники на снегу",year:"1565"},{author:"Караваджо",name:"Лютнист",year:"1596"},{author:"Рембрандт",name:"Даная",year:"1647"},{author:"Джованни Беллини",name:"Пир богов",year:"1514"},{author:"Ян ван Эйк",name:"Портрет четы Арнольфини",year:"1434"},{author:"Сандро Боттичелли",name:"Весна",year:"1482"},{author:"Леонардо да Винчи",name:"Благовещение",year:"1475"},{author:"Леонардо да Винчи",name:"Дама с горностаем",year:"1490"},{author:"Леонардо да Винчи",name:"Мадонна Литта",year:"1491"},{author:"Рафаэль",name:"Дама с единорогом",year:"1506"},{author:"Рафаэль",name:"Мадонна Бельведерская",year:"1506"},{author:"Рафаэль",name:"Сикстинская Мадонна",year:"1520"},{author:"Тициан",name:"Динарий Кесаря",year:"1516"},{author:"Тициан",name:"Кающаяся Марина Магдалина",year:"1565"},{author:"Тициан",name:"Вакханалия",year:"1526"},{author:"Тициан",name:"Венера Урбинская",year:"1534"},{author:"Тициан",name:"Конный портрет Карла V",year:"1548"},{author:"Альбрехт Дюрер",name:"Адам и Ева",year:"1507"},{author:"Альбрехт Дюрер",name:"Праздник четок",year:"1506"},{author:"Веронезе",name:"Марс и Венера",year:"1560"},{author:"Веронезе",name:"Пир в доме Левия",year:"1563"},{author:"Эль Греко",name:"Апостолы Петр и Павел",year:"1592"},{author:"Рембрандт",name:"Автопортрет с Саскией",year:"1635"},{author:"Рембрандт",name:"Христос и грешница",year:"1644"},{author:"Веласкес",name:"Бахус",year:"1628"},{author:"Веласкес",name:"Инфанта Маргарита",year:"1654"},{author:"Веласкес",name:"Поклонение волхвов",year:"1619"},{author:"Веласкес",name:"Вилла Медичи в Риме. Полдень",year:"1630"},{author:"Веласкес",name:"Венера с зеркалом",year:"1651"},{author:"Веласкес",name:"Кузница вулкана",year:"1630"},{author:"Веласкес",name:"Менины",year:"1656"},{author:"Веласкес",name:"Сдача Бреды",year:"1635"},{author:"Бартоломео Мурильо",name:"Мадонна с четками",year:"1655"},{author:"Бартоломео Мурильо",name:"Явление и дар Богородицы",year:"1655"},{author:"Бартоломео Мурильо",name:"Мальчик с собакой",year:"1650"},{author:"Бартоломео Мурильо",name:"Непорочное зачатие",year:"1678"},{author:"Никола Пуссен",name:"Пейзаж с Полифемом",year:"1649"},{author:'Ян Вермеер "Служанка с кувшином молока',name:"Молочница",year:"1660"},{author:"Жан Этьен Лиотар",name:"Шоколадница",year:"1745"},{author:"Жан Фрагонар",name:"Качели",year:"1767"},{author:"Жан Фрагонар",name:"Поцелуй украдкой",year:"1788"},{author:"Гейнсборо",name:"Дама в голубом",year:"1780"},{author:"Жан Батист Грёз",name:"Избалованное дитя",year:"1765"},{author:"Жан Батист Грёз",name:"Деревенская помолвка",year:"1761"},{author:"Владимир Боровиковский",name:"Портрет Лопухиной",year:"1797"},{author:"Джон Констебл",name:"Вид на собор в Солсбери из епископского сада",year:"1823"},{author:"Василий Тропинин",name:"Кружевница",year:"1823"},{author:"Алексей Венецианов",name:"На жатве. Лето",year:"1827"},{author:"Алексей Венециановн",name:"Спящий пастушок",year:"1826"},{author:"Алексей Венецианов",name:"На пашне. Весна",year:"1820"},{author:"Карл Брюллов",name:"Итальянский полдень",year:"1827"},{author:"Карл Брюллов",name:"Всадница",year:"1832"},{author:"Василий Перов",name:"Приезд гувернантки в купеческий дом",year:"1866"},{author:"Василий Перов",name:"Тройка",year:"1866"},{author:"Василий Перов",name:"Сельский крестный ход на Пасхе",year:"1861"},{author:"Василий Перов",name:"Птицелов",year:"1870"},{author:"Василий Перов",name:"Охотники на привале",year:"1871"},{author:"Алексей Саврасов",name:"Грачи прилетели",year:"1871"},{author:"Фёдор Васильев",name:"Мокрый луг",year:"1872"},{author:"Константин Маковский",name:"Дети, бегущие от грозы",year:"1872"},{author:"Константин Маковский",name:"Боярский свадебный пир",year:"1883"},{author:"Константин Маковский",name:"Гадание",year:"1890"},{author:"Константин Маковский",name:"Портрет графини Софьи",year:"1890"},{author:"Константин Маковский",name:"Перемещение ковра Мухаммеда из Мекки в Каир",year:"1875"},{author:"Василий Поленов",name:"Деревня Окулова гора",year:"1860"},{author:"Василий Поленов",name:"Переправа через реку",year:"1872"},{author:"Василий Поленов",name:"В парке",year:"1874"},{author:"Василий Поленов",name:"Московский дворик",year:"1877"},{author:"Василий Поленов",name:"Бабушкин сад",year:"1878"},{author:"Огюст Ренуар",name:"Мост в Шату",year:"1875"},{author:"Огюст Ренуар",name:"Прогулка в Булонском лесу",year:"1873"},{author:"Огюст Ренуар",name:"Портрет Жанны Самари",year:"1877"},{author:"Огюст Ренуар",name:"Завтрак гребцов",year:"1881"},{author:"Огюст Ренуар",name:"Зонтики",year:"1886"},{author:"Архип Куинджи",name:"На острове Валааме",year:"1873"},{author:"Архип Куинджи",name:"Украинская ночь",year:"1876"},{author:"Архип Куинджи",name:"Берёзовая роща",year:"1879"},{author:"Архип Куинджи",name:"Лунная ночь на Днепре",year:"1880"},{author:"Василий Суриков",name:"Утро стрелецкой казни",year:"1881"},{author:"Василий Суриков",name:"Взятие снежного городка",year:"1891"},{author:"Василий Суриков",name:"Покорение Сибири Ермаком Тимофеевичем",year:"1895"},{author:"Василий Суриков",name:"Переход Суворова через Альпы",year:"1899"},{author:"Валентин Серов",name:"Девочка с персиками",year:"1887"},{author:"Исаак Левитан",name:"Над вечным покоем",year:"1894"},{author:"Исаак Левитан",name:"Март",year:"1895"},{author:"Исаак Левитан",name:"Золотая осень",year:"1895"},{author:"Иван Шишкин",name:"Ручей в берёзовом лесу",year:"1883"},{author:"Иван Шишкин",name:"Рожь",year:"1878"},{author:"Иван Шишкин",name:"Корабельная роща",year:"1898"},{author:"Александра Маковский",name:"Надоела",year:"1897"},{author:"Франсуа Буше",name:"Четыре сезона - Весна",year:"1755"},{author:"Виктор Васнецов",name:"Витязь на распутье",year:"1878"},{author:"Виктор Васнецов",name:"Ковер-самолёт",year:"1880"},{author:"Виктор Васнецов",name:"Три царевны подземного царства",year:"1884"},{author:"Виктор Васнецов",name:"Иван-царевич на Сером Волке",year:"1888"},{author:"Виктор Васнецов",name:"Царь Иван Васильевич Грозный",year:"1896"},{author:"Николай Богданов-Бельский",name:"Устный счёт",year:"1895"},{author:"Николай Богданов-Бельский",name:"У дверей школы",year:"1897"},{author:"Эдуард Мане",name:"Женщина с кувшином",year:"1858"},{author:"Клод Лоррен",name:"Отплытие святой Урсулы",year:"1614"},{author:"Карл Лемох",name:"Варька",year:"1893"},{author:"Василий Тропинин",name:"Девушка с горшком роз",year:"1850"},{author:"Гюстав Курбе",name:"Мастерская художника",year:"1855"},{author:"Иван Богданов",name:"За расчётом",year:"1890"},{author:"Иван Богданов",name:"Новичок",year:"1893"},{author:"Рене Магритт",name:"Сын человеческий",year:"1964"},{author:"Сальвадор Дали",name:"Сон, вызванный полётом пчелы вокруг граната, за секунду до пробуждения",year:"1944"},{author:"Казимир Малевич",name:"Черный квадрат",year:"1915"}];new class{constructor(e,t){this.model=e,this.view=t,this.view.bindUpdateFrame(this.handleUpdateFrame.bind(this)),this.view.bindPauseGame(this.handlePauseGame.bind(this)),this.view.bindAutoClick(this.handleAutoClick.bind(this)),this.view.bindNewGameClick(this.handleNewGame.bind(this)),this.view.bindSaveClick(this.handleSave.bind(this)),this.view.bindSavedGameClick(this.handleGameLoad.bind(this)),this.view.bindGameSizeClick(this.handleSizeChange.bind(this)),this.view.bindTileStyleClick(this.handleStyleChange.bind(this)),this.view.bindLoadClick(this.handleLoadClick.bind(this)),this.view.bindBestClick(this.handleBestClick.bind(this)),this.view.bindAboutClick(this.handleAboutClick.bind(this)),this.view.bindSettingsClick(this.handleSettingsClick.bind(this)),this.model.bindTilesSwap(this.onTilesSwap.bind(this)),this.model.bindTimeChange(this.onTimeChange.bind(this)),this.model.bindPause(this.onPause.bind(this)),this.model.bindWin(this.onWin.bind(this)),this.model.bindSave(this.onSave.bind(this))}init(){this.view.displayMenu()}start(){this.model.createFrame(),this.view.displayTiles(this.model.tiles),this.model.countTime(),this.view.showTime(this.model.time),this.view.showMoves(this.model.moves),this.view.showSound(),this.view.showPause(),this.view.showAuto()}reset(){this.model.tiles=[],this.model.history=[],this.model.time=0,this.model.moves=0,this.model.isPaused=!1,clearInterval(this.model.timer),this.view.dashboard.textContent=""}load(e){this.model.loadData(e),this.view.size=this.model.size,this.view.style=this.model.style,this.view.changeFloor(),this.view.displayTiles(this.model.tiles),this.model.countTime(),this.view.showTime(this.model.time),this.view.showMoves(this.model.moves),this.view.showSound(),this.view.showPause(),this.view.showAuto()}onTilesSwap(e,t){this.view.updateTiles(e),this.view.showMoves(t)}handleUpdateFrame(e){this.model.updateFrame(e)}onTimeChange(e){this.view.showTime(e)}onPause(){this.view.showPauseMessage()}onWin(e,t){this.view.showWinMessage(e,t)}onSave(){this.view.showSaveMessage()}handlePauseGame(){this.model.isPaused=!this.model.isPaused,this.model.countTime()}handleAutoClick(){this.model.isAuto=!0,this.view.showSolution(this.model.solvePuzzle())}handleNewGame(){this.reset(),this.start()}handleSave(){this.model.save()}handleLoadClick(){this.view.displayLoadMenu(this.model.savedGames)}handleBestClick(){const e=this.model.bestRecords.find((e=>{const t=e[0].size===this.model.size,s=e[0].style===this.model.style;return t&&s}))||[];this.view.displayBestResults(e)}handleAboutClick(){this.view.displayAbout()}handleSettingsClick(){this.view.displaySettings()}handleGameLoad(e){const t=this.model.savedGames.find((t=>t.date===e.dataset.date));t&&(this.view.loadMenu.innerHTML="",this.load(t))}handleSizeChange(e){this.reset(),this.model.size=+e,this.view.size=+e,this.model.createFrame(),this.view.displayMenu(),this.view.displaySettings()}handleStyleChange(e){this.reset(),this.view.style=+e,this.model.style=+e,this.view.changeFloor(),this.model.createFrame(),this.view.displayMenu(),this.view.displaySettings()}}(new class{constructor(e){this.size=e,this.tiles=[],this.savedGames=JSON.parse(localStorage.getItem("gem-puzzle-saves"))||[],this.time=0,this.moves=0,this.isPaused=!1,this.bestRecords=JSON.parse(localStorage.getItem("gem-puzzle-best"))||[],this.style=0}createFrame(){const t=this.size*this.size;for(let e=0;e<t;e+=1)this.tiles.push(e);this.tiles=e.shuffle(this.tiles);let s=0,a=0;for(let e=0;e<t;e+=1)if(0===this.tiles[e])s=Math.floor(e/this.size)+1;else for(let s=e+1;s<t;s+=1)this.tiles[s]<this.tiles[e]&&0!==this.tiles[s]&&(a+=1);const i=a+s;this.size%2!=0?a%2!=0&&(this.tiles=[],this.createFrame()):i%2!=0&&(this.tiles=[],this.createFrame()),this.sortedTiles=this.tiles.slice().sort(((e,t)=>e-t)).slice(1),this.sortedTiles.push(0)}updateFrame(e){const t=this.tiles.indexOf(0);if([this.tiles[t],this.tiles[e]]=[this.tiles[e],this.tiles[t]],this.moves+=1,this.onTilesSwap(this.tiles,this.moves),this.tiles.toString()===this.sortedTiles.toString()){if(this.onWin(this.time,this.moves),this.isAuto)return this.isAuto=!1,void clearInterval(this.timer);const e={size:this.size,time:this.time,moves:this.moves,style:this.style},t=this.bestRecords.find((e=>{const t=e[0].size===this.size,s=e[0].style===this.style;return t&&s}));t?(t.push(e),t.sort(((e,s)=>{const a=t.reduce(((e,t)=>Math.max(e,t.moves)),0),i=t.reduce(((e,t)=>Math.min(e,t.moves)),0),n=t.reduce(((e,t)=>Math.max(e,t.time)),0),o=t.reduce(((e,t)=>Math.min(e,t.time)),0),r=(a-e.moves)/(a-i)+(n-e.time)/(n-o);return(a-s.moves)/(a-i)+(n-s.time)/(n-o)-r})),t.length>10&&t.splice(10)):this.bestRecords.push([e]),localStorage.setItem("gem-puzzle-best",JSON.stringify(this.bestRecords)),clearInterval(this.timer)}}countTime(){if(this.isPaused)return clearInterval(this.timer),void this.onPause();this.timer=setInterval((()=>{this.time+=1,this.onTimeChange(this.time)}),1e3)}save(){const e={size:this.size,time:this.time,moves:this.moves,date:JSON.parse(JSON.stringify(new Date)),frame:this.tiles.slice(),style:this.style};this.savedGames.unshift(e),localStorage.setItem("gem-puzzle-saves",JSON.stringify(this.savedGames)),this.onSave()}loadData(e){this.size=e.size,this.time=e.time,this.moves=e.moves,this.tiles=e.frame.slice(),this.style=e.style,this.sortedTiles=this.tiles.slice().sort(((e,t)=>e-t)).slice(1),this.sortedTiles.push(0),this.isPaused=!1}bindTilesSwap(e){this.onTilesSwap=e}bindTimeChange(e){this.onTimeChange=e}bindPause(e){this.onPause=e}bindWin(e){this.onWin=e}bindSave(e){this.onSave=e}solvePuzzle(){function e(e,t){const s=t.indexOf(e);return[Math.floor(s/Math.sqrt(t.length))+1,s%Math.sqrt(t.length)+1]}function t(t,s,a){const i=e(t,a),n=e(s,a);return Math.abs(i[0]-n[0])+Math.abs(i[1]-n[1])}function s(s,a,i,n){if(s===a)return i.indexOf(s);const o=function(t,s,a){const i=[],n=s.indexOf(t),o=e(t,s),r=s[n-Math.sqrt(s.length)],h=s[n+1],l=s[n+Math.sqrt(s.length)],u=s[n-1];return(r||0===r)&&(a.includes(r)||i.push(r)),!h&&0!==h||e(h,s)[0]!==o[0]||a.includes(h)||i.push(h),(l||0===l)&&(a.includes(l)||i.push(l)),!u&&0!==u||e(u,s)[0]!==o[0]||a.includes(u)||i.push(u),i}(s,i,n),r=[];o.forEach((e=>{const s=t(e,a,i);r.push(s)}));const h=Math.min(...r),l=o[r.indexOf(h)];return i.indexOf(l)}function a(e,t,s){const a=e;[a[t],a[s]]=[a[s],a[t]]}function i(e,i,n,o){const r=i;let h=t(0,e,i);for(;h>1;){const l=r.indexOf(0),u=s(0,e,i,o);n.push(u),a(i,l,u),h=t(0,e,i)}return n}function n(t,s,i,n,o){const r=function(t,s){const a=[],i=s.indexOf(t),n=Math.sqrt(s.length),o=s[i-n];a.push(o);const r=s[i-n+1];a.push(r);const h=s[i+1];a.push(h);const l=s[i+n+1];a.push(l);const u=s[i+n];a.push(u);const d=s[i+n-1];a.push(d);const m=s[i-1];a.push(m);const c=s[i-n-1];a.push(c);const p=e(t,s);return 1===p[0]&&(a[0]=-1,a[1]=-1,a[7]=-1),p[0]===n&&(a[3]=-1,a[4]=-1,a[5]=-1),1===p[1]&&(a[5]=-1,a[6]=-1,a[7]=-1),p[1]===n&&(a[1]=-1,a[2]=-1,a[3]=-1),a}(t,i),h=r.indexOf(0),l=r.indexOf(s);let u=[],d=[],m=[];if(h===l)return;for(let e=h+1;e!==l;e+=1){if(-1===r[e]||n.includes(r[e])){u=!1;break}u.push(r[e]),7===e&&(e=-1)}for(let e=h-1;e!==l;e-=1){if(e<0&&(e=7),-1===r[e]||n.includes(r[e])){d=!1;break}d.push(r[e])}m=u&&d?u.length<d.length?u:d:u||d,m.forEach((e=>{const t=i.indexOf(e),s=i.indexOf(0);o.push(t),a(i,s,t)}));const c=i.indexOf(0),p=i.indexOf(s);o.push(p),a(i,c,p)}function o(e,t,o,r,h){let l=o.indexOf(e);if(l!==t)for(i(e,o,h,r);l!==t;){const i=o[s(e,o[t],o,r)];if(0===i){const e=o.indexOf(0);h.push(l),a(o,e,l)}else n(e,i,o,r,h);l=o.indexOf(e)}}function r(e,t,s){const i=Math.sqrt(t.length),n=t.indexOf(0);"up"===e&&(s.push(n-i),a(t,n,n-i)),"right"===e&&(s.push(n+1),a(t,n,n+1)),"down"===e&&(s.push(n+i),a(t,n,n+i)),"left"===e&&(s.push(n-1),a(t,n,n-1))}function h(e,t,s){const a=Math.sqrt(t.length),i=t.slice((e-1)*a,e*a);return!!i.every(((t,s)=>t===(e-1)*a+s+1))&&(i.forEach((e=>{s.includes(e)||s.push(e)})),!0)}function l(e,t,s,l){const u=Math.sqrt(t.length);if(h(e,t,s))return;for(let a=1;a<u-1;a+=1){const i=(e-1)*u+a;if(o(i,i-1,t,s,l),h(e,t,s))return;s.push(i)}const d=e*u;o(d,d-2,t,s,l),s.push(d);let m=t[e*u-1];const c=e*u-1;if(0===m&&(r("down",t,l),m=t[e*u-1]),m===c){i(t[e*u],t,l,s),l.push(e*u),a(t,e*u,e*u+1),r("up",t,l);for(let e=0;e<u-1;e+=1)r("right",t,l);r("down",t,l),r("left",t,l),r("up",t,l);for(let s=e*u-2;s>(e-1)*u;s-=1)r("left",t,l);r("down",t,l)}else o(c,(e+1)*u-2,t,s,l);s.push(c);const p=t[e*u-1];i(c,t,l,s),n(c,p,t,s,l),r("left",t,l),r("down",t,l)}const u=this.tiles.slice(),d=u.slice().sort(((e,t)=>e-t)).slice(1),m=Math.sqrt(u.length);d.push(0);const c=[],p=[];for(let e=1;e<m-1;e+=1)l(e,u,p,c);return function(e,t,s,a){const n=Math.sqrt(e.length);for(let a=1;a<n-1;a+=1){const h=n*(n-1)+a,l=n*(n-2)+a,u=e.indexOf(l)===l-1,d=e.indexOf(h)===h-1;if(u&&d)t.push(l),t.push(h);else if(o(h,l-1,e,t,s),t.push(h),0===e[e.indexOf(h)+n]&&r("right",e,s),e.indexOf(l)+1===h)i(l,e,s,t),r("left",e,s),r("up",e,s),r("right",e,s),r("down",e,s),r("right",e,s),r("up",e,s),r("left",e,s),r("left",e,s),r("down",e,s),r("right",e,s),r("up",e,s),r("right",e,s),r("down",e,s),r("left",e,s),r("left",e,s),r("up",e,s),r("right",e,s),t.push(l);else{o(l,l,e,t,s);const a=e[e.indexOf(h)+n];0!==a&&(i(a,e,s,t),r("left",e,s)),r("up",e,s),r("right",e,s),t.push(l)}}for(let t=0;t<4&&(r("down",e,s),e.toString()!==a.toString())&&(r("right",e,s),e.toString()!==a.toString())&&(r("up",e,s),e.toString()!==a.toString())&&(r("left",e,s),e.toString()!==a.toString());t+=1);}(u,p,c,d),c}}(4),new class{constructor(t){this.size=t,this.container=e.createElement("div","container"),this.dashboard=e.createElement("div","dashboard"),this.frameList=e.createElement("ul","frame-list"),this.frameList.classList.add(`frame-list-${t}`),this.gameMenu=e.createElement("ul","game-menu"),this.loadMenu=e.createElement("div","load-menu"),this.bestResults=e.createElement("div","best-results"),this.about=e.createElement("div","about"),this.settingsMenu=e.createElement("div","settings-menu"),this.container.append(this.dashboard),this.container.append(this.frameList),document.body.append(this.container),this.soundIsOn=!0,this.style=0,this.tilesLi=[],this.isAuto=!1,this.isPause=!1}displayMenu(){this.gameMenu.style.backgroundImage="",this.gameMenu.innerHTML='<li class="game-name"><table class="game-name-table"><tr><td class="rss-word">R</td><td class="rss-word">S</td><td class="rss-word">S</td><td class="gem-puzzle-name"><span class="gem-word">Gem</span><span class="puzzle-word">Puzzle</span></td></tr></table></li><li class="game-menu-item">New Game</li><li class="game-menu-item">Load</li><li class="game-menu-item">Best Scores</li><li class="game-menu-item">About</li><li class="game-menu-item">Settings</li>',this.frameList.append(this.gameMenu)}displayLoadMenu(s){this.loadMenu.innerHTML="";const a=e.createElement("h2","load-menu-header");a.textContent="Load";const i=e.createElement("ol","saves-list"),n=e.createElement("button","back-button");n.textContent="Back",s.forEach((s=>{const a=e.createElement("li","save-item"),n=new Date(Date.parse(s.date));a.setAttribute("data-date",s.date);const o=n.getMonth()+1,r=n.getDate(),h=e.padWithZeroes(n.getHours()),l=e.padWithZeroes(n.getMinutes()),u=e.padWithZeroes(n.getSeconds());a.innerHTML=`${o}/${r}, ${h}:${l}:${u} (${s.size}x${s.size}, ${s.moves}mov, ${s.time}sec)<br><span class="load-picture">${0===s.style?"digits":t[s.style-1].name}</span>`,i.append(a)}));const o=e.createElement("div","no-save");o.textContent="No saves yet",this.loadMenu.append(a),0!==s.length?this.loadMenu.append(i):this.loadMenu.append(o),this.loadMenu.append(n),this.gameMenu.append(this.loadMenu)}displayBestResults(s){this.bestResults.innerHTML="";const a=e.createElement("h2","records-header");a.textContent=`${this.size}x${this.size}`;const i=e.createElement("h2","records-subheader");0===this.style?i.textContent="Digits":i.textContent=`«${t[this.style-1].name}»`;const n=e.createElement("table","records-table"),o=e.createElement("button","back-button");o.textContent="Back",s.forEach(((t,s)=>{const a=e.createElement("tr"),i=e.createElement("td"),o=e.createElement("td"),r=e.createElement("td");i.textContent=`${s+1}`;const h=e.formatTime(t.time).split(":");let l;switch(h.length){case 3:l=`${+h[0]} h ${+h[1]} min ${+h[2]} sec`;break;case 2:l=`${+h[0]} min ${+h[1]} sec`;break;default:l=+h[0]+" sec"}r.textContent=l,o.textContent=`${t.moves} moves`,a.append(i),a.append(r),a.append(o),n.append(a)}));const r=e.createElement("div","no-records");r.textContent="No records yet",this.bestResults.append(a),this.bestResults.append(i),0!==s.length?this.bestResults.append(n):this.bestResults.append(r),this.bestResults.append(o),this.bestResults.addEventListener("click",(e=>{"Back"===e.target.textContent&&(this.bestResults.innerHTML="",this.bestResults.remove())})),this.gameMenu.append(this.bestResults)}displayAbout(){this.about.innerHTML="";const t=e.createElement("h2","about-header");t.textContent="About";const s=e.createElement("div","about-text");s.innerHTML="<p>Раскладка классическая, то есть цифры нужно расставить по порядку слева направо, сверху вниз. Пустой должна остаться последняя клетка.</p><p>Таблица рекордов заводится отдельная для каждого стиля костяшек и каждого размера. То есть, к примеру, у 3x3 «Алёнушки», 5x5 «Алёнушки», 3x3 «Садко», 5x5 «Садко» будут свои рекорды.</p><p>Сами рекорды рассчитываются сразу по двум параметрам, поэтому возможны случаи, когда времени затрачено больше, но результат выше в рейтинге за счёт того, что сделано меньше ходов. И наоборот.</p><p>Если вы столкнулись с проблемой или у вас возникли вопросы по игре, пишите на femiarkh@gmail.com или в дискорд Dammy#7897.</p>";const a=e.createElement("button","back-button");a.textContent="Back",this.about.append(t),this.about.append(s),this.about.append(a),this.about.addEventListener("click",(e=>{"Back"===e.target.textContent&&(this.about.innerHTML="",this.about.remove())})),this.gameMenu.append(this.about)}displaySettings(){this.settingsMenu.innerHTML="";const s=e.createElement("h2","settings-header");s.textContent="Settings";const a=e.createElement("p","settings-warning");a.textContent="Current game would be lost once you change these settings";const i=e.createElement("div","choose-size-box");i.innerHTML='<div class="settings-box"><h3 class="settings-subheader">Board size</h3><label for "game-size">Choose size: </label><select name="game-size" id="game-size"><option value="3">3x3</option><option value="4">4x4</option><option value="5">5x5</option><option value="6">6x6</option><option value="7">7x7</option><option value="8">8x8</option></select></div>',i.querySelector(`option[value="${this.size}"]`).selected=!0;const n=e.createElement("div","choose-style-box");n.innerHTML=`<div class="settings-box"><h3 class="settings-subheader">Style of tiles</h3><label for "game-size">Choose style: </label><select name="tile-style" id="tile-style"><option value="0">0. Digits</option>${function(e){let s="";for(let e=0;e<150;e+=1)s+=`<option value="${e+1}">${e+1}. ${t[e].name}</option>`;return s}()}</select></div>`,n.querySelector(`option[value="${this.style}"]`).selected=!0;const o=e.createElement("button","back-button");o.textContent="Back",this.settingsMenu.append(s),this.settingsMenu.append(a),this.settingsMenu.append(i),this.settingsMenu.append(n),this.settingsMenu.append(o),this.settingsMenu.addEventListener("click",(e=>{"Back"===e.target.textContent&&(this.settingsMenu.innerHTML="",this.settingsMenu.remove())})),this.gameMenu.append(this.settingsMenu)}displayTiles(t){for(;this.frameList.firstChild;)this.frameList.removeChild(this.frameList.firstChild);0!==this.tilesLi.length&&(this.tilesLi=[]);const s=t.indexOf(0);t.forEach(((t,a)=>{const i=e.createElement("li","tile");i.classList.add(`tile-${this.size}`);const n=Math.abs(a-s),o=Math.floor(a/this.size)===Math.floor(s/this.size);if((1===n&&o||n===this.size)&&i.classList.add("tile-movable"),i.setAttribute("data-id",t),0===this.style)i.textContent=0===t?"":t;else if(0!==t){i.textContent="";const e=(t-1)%this.size,s=Math.floor((t-1)/this.size),a=100/(this.size-1);i.style.backgroundImage=`url(./assets/images/frames/${this.style}.jpg)`,i.style.backgroundSize=`${this.frameList.clientWidth}px ${this.frameList.clientHeight}px`,i.style.backgroundPosition=`${e*a}% ${s*a}%`}0===t&&i.classList.add("zero-tile"),this.tilesLi.push(i),this.frameList.append(i)})),window.addEventListener("resize",(()=>{Array.from(this.frameList.querySelectorAll(".tile")).forEach((e=>{e.style.backgroundSize=`${this.frameList.clientWidth}px ${this.frameList.clientHeight}px`}))}))}updateTiles(e){for(;this.frameList.firstChild;)this.frameList.removeChild(this.frameList.firstChild);e.forEach((e=>{const t=this.tilesLi.find((t=>+t.dataset.id===e));this.frameList.append(t)})),this.tilesLi=Array.from(this.frameList.querySelectorAll(".tile")),this.updateGlow()}updateGlow(){if(this.tilesLi.forEach((e=>{e.classList.remove("tile-movable")})),this.isAuto)return;const e=this.tilesLi.findIndex((e=>"0"===e.dataset.id));this.tilesLi.slice().filter(((t,s)=>{const a=Math.abs(e-s),i=Math.floor(s/this.size)===Math.floor(e/this.size);return 1===a&&i||a===this.size})).forEach((e=>{e.classList.add("tile-movable")}))}changeFloor(){this.frameList.style.backgroundImage=0===this.style?'url("./assets/images/floor.jpg")':`linear-gradient(rgba(255, 255, 255, 0.6),\n    rgba(255, 255, 255, 0.6)),url("./assets/images/frames/${this.style}.jpg")`}showTime(t){this.dashboard.querySelector(".time-box")&&this.dashboard.querySelector(".time-box").remove();const s=e.createElement("span","time-box");s.innerHTML=`Time: <span class="time-digits">${e.formatTime(t)}</span>`,this.dashboard.append(s)}showMoves(t){this.dashboard.querySelector(".moves")&&this.dashboard.querySelector(".moves").remove();const s=e.createElement("span","moves");s.innerHTML=`Moves: <span class="move-digits">${t}</span>`,this.dashboard.append(s)}showSound(){if(this.dashboard.querySelector(".sound"))return;const t=e.createElement("div","sound");t.innerHTML=this.soundIsOn?'<img src="./assets/icons/volume-up.svg" width="30" height="30">':'<img src="./assets/icons/volume-off.svg" width="30" height="30">',this.dashboard.append(t),this.dashboard.addEventListener("click",(e=>{const t=e.target.parentElement;t&&t.classList.contains("sound")&&(this.soundIsOn=!this.soundIsOn,t.innerHTML=this.soundIsOn?'<img src="./assets/icons/volume-up.svg" width="30" height="30">':'<img src="./assets/icons/volume-off.svg" width="30" height="30">')}))}showAuto(){this.dashboard.querySelector(".auto")&&this.dashboard.querySelector(".auto").remove();const t=e.createElement("span","auto");t.textContent="Auto",this.dashboard.append(t)}showPause(){if(this.dashboard.querySelector(".pause"))return;const t=e.createElement("span","pause");t.textContent="Pause",this.dashboard.append(t)}showPauseMessage(){this.isPause=!0,this.dashboard.querySelector(".pause").classList.toggle("pause-active",this.isPause),this.gameMenu.style.backgroundImage="",this.gameMenu.innerHTML='<li class="game-menu-item">Resume</li><li class="game-menu-item">New Game</li><li class="game-menu-item">Save</li><li class="game-menu-item">Load</li><li class="game-menu-item">Best Scores</li><li class="game-menu-item">Settings</li>';const t=e.createElement("li","pause-message");t.textContent="Game is paused",this.gameMenu.prepend(t),this.frameList.append(this.gameMenu)}showWinMessage(s,a){if(this.isAuto){let t;this.isAuto=!1,window.removeEventListener("blur",this.onAutoBlur),window.removeEventListener("focus",this.onAutoFocus),this.gameMenu.innerHTML='<li class="game-menu-item try-again">Try Again</li><li class="game-menu-item">Load</li><li class="game-menu-item">Best Scores</li><li class="game-menu-item">Settings</li>',this.frameList.append(this.gameMenu),document.querySelector("[data-sound=auto-win]")?t=document.querySelector("[data-sound=auto-win]"):(t=e.createElement("audio"),t.setAttribute("data-sound","auto-win"),t.src="assets/sounds/auto-win.wav",document.body.append(t)),this.soundIsOn&&t.play()}else{const i=e.createElement("li","win-message"),n=e.formatTime(s).split(":");let o,r="",h="",l="",u="";switch(n.length){case 3:h="01"===n[0]?"hour":"hours",l="01"===n[1]?"minute":"minutes",u="01"===n[2]?"second":"seconds",r=`${+n[0]} ${h}, ${+n[1]} ${l} and ${+n[2]} ${u}`;break;case 2:l="01"===n[0]?"minute":"minutes",u="01"===n[1]?"second":"seconds",r=`${+n[0]} ${l} and ${+n[1]} ${u}`;break;default:u="01"===n[0]?"second":"seconds",r=`${+n[0]} ${u}`}if(i.innerHTML=`Congrats!<br>You solved this puzzle<br>in ${r}<br>with ${a} moves`,this.gameMenu.innerHTML='<li class="game-menu-item">New Game</li><li class="game-menu-item">Load</li><li class="game-menu-item">Best Scores</li><li class="game-menu-item">Settings</li>',0!==this.style){this.gameMenu.style.backgroundColor="rgba(0,0,0,0.6)",this.gameMenu.style.backgroundImage=`linear-gradient(rgba(0, 0, 0, 0.1),\n        rgba(0, 0, 0, 0.1)),url("./assets/images/frames/${this.style}.jpg")`;const s=e.createElement("li","picture-info");s.textContent=`${t[this.style-1].author}, «${t[this.style-1].name}», ${t[this.style-1].year}г.`,this.gameMenu.prepend(s)}this.gameMenu.prepend(i),this.frameList.append(this.gameMenu),document.querySelector("[data-sound=win]")?o=document.querySelector("[data-sound=win]"):(o=e.createElement("audio"),o.setAttribute("data-sound","win"),o.src="assets/sounds/win.wav",document.body.append(o)),this.soundIsOn&&o.play()}}showSaveMessage(){const t=e.createElement("div","save-message");t.textContent="Game is saved!",this.frameList.append(t),setTimeout((()=>{t.remove()}),1e3)}showSolution(e){this.isAuto=!0,this.dashboard.querySelector(".auto").classList.toggle("auto-active",this.isAuto),this.updateGlow();const t=e.slice(),s=new Event("click",{bubbles:!0});let a=0;const i=setInterval((()=>{let e=this.frameList.querySelectorAll(".tile");e[t[a]].dispatchEvent(s),e=this.frameList.querySelectorAll(".tile"),a+=1,a===t.length&&(this.dashboard.querySelector(".auto").classList.remove("auto-active"),clearInterval(i),window.removeEventListener("blur",this.onAutoBlur),window.removeEventListener("focus",this.onAutoFocus))}),300);this.onAutoBlur=()=>{const e=this.dashboard.querySelector(".pause");e.dispatchEvent(s),this.isPause=!0,e.classList.toggle("pause-active",this.isPause),clearInterval(i),window.removeEventListener("blur",this.onAutoBlur)},this.onAutoFocus=()=>{const e=this.dashboard.querySelector(".pause");e.dispatchEvent(s),this.isPause=!1,e.classList.toggle("pause-active",this.isPause),window.removeEventListener("focus",this.onAutoFocus),this.showSolution(t.slice(a))},window.addEventListener("blur",this.onAutoBlur),window.addEventListener("focus",this.onAutoFocus)}bindSavedGameClick(e){this.loadMenu.addEventListener("click",(t=>{t.target.classList.contains("save-item")&&e(t.target),t.target.classList.contains("load-picture")&&e(t.target.parentElement),"Back"===t.target.textContent&&(this.loadMenu.innerHTML="",this.loadMenu.remove())}))}bindGameSizeClick(e){this.settingsMenu.addEventListener("change",(t=>{"game-size"===t.target.id&&e(t.target.value)}))}bindTileStyleClick(e){this.settingsMenu.addEventListener("change",(t=>{"tile-style"===t.target.id&&e(t.target.value)}))}bindNewGameClick(e){this.gameMenu.addEventListener("click",(t=>{"New Game"!==t.target.textContent&&"Try Again"!==t.target.textContent||e()}))}bindSaveClick(e){this.gameMenu.addEventListener("click",(t=>{"Save"===t.target.textContent&&e()}))}bindLoadClick(e){this.gameMenu.addEventListener("click",(t=>{"Load"===t.target.textContent&&e()}))}bindBestClick(e){this.gameMenu.addEventListener("click",(t=>{"Best Scores"===t.target.textContent&&e()}))}bindAboutClick(e){this.gameMenu.addEventListener("click",(t=>{"About"===t.target.textContent&&e()}))}bindSettingsClick(e){this.gameMenu.addEventListener("click",(t=>{"Settings"===t.target.textContent&&e()}))}bindPauseGame(e){this.dashboard.addEventListener("click",(t=>{if(!this.frameList.querySelector(".win-message")&&!this.frameList.querySelector(".try-again")&&t.target.classList.contains("pause")){if(this.isAuto&&t.isTrusted)return;this.frameList.querySelector(".pause-message")&&(this.dashboard.querySelector(".pause").classList.remove("pause-active"),this.frameList.querySelector(".game-menu").remove()),e()}})),this.frameList.addEventListener("click",(t=>{"Resume"===t.target.textContent&&(this.frameList.querySelector(".pause-message")&&(this.dashboard.querySelector(".pause").classList.remove("pause-active"),this.frameList.querySelector(".game-menu").remove()),e())}))}bindAutoClick(e){this.dashboard.addEventListener("click",(t=>{t.target.classList.contains("auto")&&(this.isAuto||this.frameList.querySelector(".game-menu")||e())}))}bindUpdateFrame(t){this.frameList.addEventListener("mousedown",(s=>{const a=s.target,i=s.clientX,n=s.clientY,o=i-a.getBoundingClientRect().left,r=n-a.getBoundingClientRect().top;function h(e,t){a.style.left=e-o+"px",a.style.top=t-r+"px"}function l(e){h(e.pageX,e.pageY)}if(s.target.classList.contains("tile")){if(this.isAuto)return;if(this.mouseDownTime&&(new Date).getTime()-this.mouseDownTime<300)return;this.mouseDownTime=(new Date).getTime();const o=Array.from(this.frameList.querySelectorAll(".tile")),r=o.indexOf(o.find((e=>"0"===e.getAttribute("data-id")))),u=this.tilesLi.indexOf(a),d=Math.abs(r-u),m=Math.floor(r/this.size),c=Math.floor(u/this.size);if(1===d&&m===c||d===this.size){const d=getComputedStyle(a),m=e.createElement("li","tile");m.style.width=d.width,m.style.height=d.height,m.style.background="transparent",m.style.borderColor="transparent",a.before(m);const c=a.cloneNode();c.textContent=a.textContent,a.style.position="absolute",a.style.zIndex=9999,a.style.width=d.width,a.style.height=d.height,document.body.append(a),h(s.pageX,s.pageY),document.addEventListener("mousemove",l),a.onmouseup=s=>{const h=s.clientX,p=s.clientY;document.removeEventListener("mousemove",l),a.onmouseup=null;const g=(new Date).getTime()-this.mouseDownTime,y=Math.abs(h-i),v=Math.abs(p-n);if(y<10&&v<10&&g<300){switch(r-u){case 1:a.classList.add("tile-right");break;case this.size:a.classList.add("tile-down");break;case-1:a.classList.add("tile-left");break;default:a.classList.add("tile-up")}a.addEventListener("transitionend",(()=>{let s;document.querySelector("[data-sound=tile-swap]")?s=document.querySelector("[data-sound=tile-swap]"):(s=e.createElement("audio"),s.setAttribute("data-sound","tile-swap"),s.src="assets/sounds/tile-swap.wav",document.body.append(s)),this.soundIsOn&&s.play(),this.tilesLi[u]=c,a.remove(),t(u)}))}else{const s=parseInt(d.width,10),i=parseInt(d.height,10),n=a.getBoundingClientRect(),h=n.left+s/2,l=n.top+i/2,p=o[r].getBoundingClientRect(),g=p.left+s/2,y=p.top+i/2,v=Math.abs(g-h),f=Math.abs(y-l);if(v<.3*s&&f<.3*i){let s;document.querySelector("[data-sound=tile-swap]")?s=document.querySelector("[data-sound=tile-swap]"):(s=e.createElement("audio"),s.setAttribute("data-sound","tile-swap"),s.src="assets/sounds/tile-swap.wav",document.body.append(s)),this.soundIsOn&&s.play(),this.tilesLi[u]=c,a.remove(),t(u)}else this.tilesLi[u]=c,a.remove(),m.replaceWith(c)}},a.ondragstart=()=>!1}}})),this.frameList.addEventListener("click",(s=>{if(s.target.classList.contains("tile")&&!s.isTrusted){const a=s.target,i=a.cloneNode();i.textContent=a.textContent;const n=Array.from(this.frameList.querySelectorAll(".tile")),o=n.indexOf(n.find((e=>"0"===e.getAttribute("data-id")))),r=this.tilesLi.indexOf(a);switch(o-r){case 1:a.classList.add("tile-right");break;case this.size:a.classList.add("tile-down");break;case-1:a.classList.add("tile-left");break;default:a.classList.add("tile-up")}a.addEventListener("transitionend",(()=>{let s;document.querySelector("[data-sound=tile-swap]")?s=document.querySelector("[data-sound=tile-swap]"):(s=e.createElement("audio"),s.setAttribute("data-sound","tile-swap"),s.src="assets/sounds/tile-swap.wav",document.body.append(s)),this.soundIsOn&&s.play(),this.tilesLi[r]=i,a.remove(),t(r)}))}}))}}(4)).init()})();